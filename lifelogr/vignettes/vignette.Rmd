---
title: "Introduction to lifelogr"
date: "`r Sys.Date()`"
output: 
  pdf_document:
    fig_width: 6
    fig_height: 3

vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, echo = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

```{r}
library(lifelogr)
```


[Lifelogging][http://lifestreamblog.com/lifelogging/] is the "process of 
tracking personal data generated by our own behavioral activities."  Examples of
lifelogging include tracking one's exercise and sleep.  While devices like 
iPhones and fitbits make collecting data on oneself easy, interpreting that data
is more difficult.

The lifelogr package makes life logging easy by:

- Creating three sets of visualizations
- Creating an experimentation framework

This package was designed to work with fitbit data, but users can also
provide their own data.  However, except for Apple data, the data types must
match that provided here for lifelogr's functions to work.

## Data

Fitbit users can provide their username and password.  Fitbit allows login via
Facebook and Google, but this library only works with fitbit login.
```{r, eval = FALSE}
EX <- Person$new(fitbit_user_email = "example@domain.com", 
                 fitbit_user_pw = "password",
                 apple_data_file = "apple.csv",
                 addl_data = NA,
                 user_info = list("name" = "EX", "age" = 29, "gender" = "male"),
                 target_steps = 10000,
                 group_assignments = list(data.frame(NA), data.frame(NA)),
                 start_date = "2017-01-19", end_date = "2017-02-17")
```

```{r}
load("../data/EX.rda")
# data(EX)
```


iPhone users can provide their Apple data as a csv.  There is an iOS app called 
QS Access (quantified self) where you can select which measures you would like
and on which time scale (by day or by hour), and it will create a csv file for
you.  For greater compatibility with the lifelogr package, users are highly 
recommended to select the "by hour" time interval.

Users can provide other sources of data as a data frame, as an argument to 
`addl_data` or `addl_data2`.

EX is an instance of the Person class, which has 3 main public data frames:
`fitbit_daily`, `fitbit_intraday`, and `util`.

Here is the structure of `fitbit_daily`, which has fitbit data recorded on a
daily basis.
```{r}
dplyr::glimpse(EX$fitbit_daily)
```

Here is the structure of `fitbit_intraday`, which has fitbit data recorded on an
intraday basis, generally every 15 minutes, although for certain variables, such
as heart rate, every 5 minutes.
```{r}
dplyr::glimpse(EX$fitbit_intraday)
```


Here is the structure of `fitbit_util`, which has information about the dates
in the range specified by the user when creating the Person instantiation, such
as day of week and month.
```{r}
dplyr::glimpse(EX$util)
```

DO I NEED THIS SECTION?
### Dates, Times, and Date-Times

Dates and times come in numerous forms.  lifelogr uses three primary types of
dates/times:

* date: "2017-03-20"
* time: "08:00:00"
* date-time: this refers to a combination of a date and a time and is the most
common unit of analysis in this package

## Visualization

There are 3 functions which allow for a series of plots with just one function
call: `plot_sleep_all`, `plot_daily_all`, and `plot_intraday_all`.  Each acts 
like the `plot.lm` function, where users must click "enter" to see the next plot.

Each plot within the generic plot function can also be called individually.

Here are the sleep plots for EX:
```{r}
plot_sleep_all(EX)
```

Users can also call each function individually using 
`plot_sleep(person, plot_type)`.
For example:
```{r}
plot_sleep(EX, "by_datetime")
```


Some plots have other options.

For example, `plot_sleep_start_end` has a `color_var = "day_of_week"` argument 
to color the lines by day of the week instead of weekend/weekday.
```{r}
plot_sleep_start_end(EX, "day_of_week")
```

Here are the plots for the daily totals for EX:
```{r}
plot_daily_all(EX)
```

Users can also call each function individually using:
```{r}
plot_daily(EX, "steps")
```

Here are the plots for intraday data (multiple data points collected within each
day).  The default is to aggregate the data by time intervals within each day
so that data for a "typical day" is displayed.
```{r}
plot_intraday_all(EX)
```

However, it is also possible to specify that the plots use the raw data and plot
over all date-times.

```{r}
plot_intraday_all(EX, FALSE)
```

## Experimentation Framework

While almost all the visualizations shown above had date, date-time, or time on 
the x axis, the experimentation framework allows for greater flexibility.  Users
can select any variables of interest and examine their relationship.

Users can specify
* x variables of interest
* y measures of interest
* type of analysis ("plot", "correlation", "anova", "compare_groups", or 
"regression")
* time variable (date, time, or datetime)

The `experiment` function will study every pairwise combination of the variable
and measure variables given.

1.  Plots
    To plot the relationship between sleep duration and resting heart 
    rate and the relationship between day of week and resting heart rate on a 
    date basis:
    ```{r, fig.show = "hold"}
    experiment(person = EX, 
               variables = list("fitbit_daily" = c("sleepDuration"),
                                "util" = c("day_of_week")),
               measures = list("fitbit_daily" = c("restingHeartRate")), 
               analysis = c("plot"),
               time_var = c("date"))
    ```

2.  Correlation
    To calculate the correlation between sleep duration and number of steps on
    a date basis:
    ```{r}
    dataset <- create_dataset(person = EX,
                              all_variables = list("fitbit_daily" = c("sleepDuration", 
                                                                      "steps")), 
                              time_var = c("date"))
    
    correlation_df <- correlation(dataset, person = EX, 
                                  variables = list("fitbit_daily" = c("sleepDuration")),
                                  measures = list("fitbit_daily" = c("steps")),
                                  time_var = "date")
    
    # # would rather do
    # experiment(person = EX, 
    #            variables = list("fitbit_daily" = c("sleepDuration")),
    #            measures = list("fitbit_daily" = c("restingHeartRate")), 
    #            analysis = c("correlation"),
    #            time_var = c("date"))
```

3.  ANOVA
    To create ANOVAs for the effect of sleep duration and day of week on resting
    heart rate on a date basis:
```{r}
dataset <- create_dataset(person = EX,
                          all_variables = list("util" = c("day_of_week"), 
                                               "fitbit_daily" = c("sleepDuration", 
                                                                  "restingHeartRate")), 
                          time_var = c("date"))

all_anovas <- l_anova(dataset, person = EX, variables = list("util" = c("day_of_week"), 
                                               "fitbit_daily" = c("sleepDuration")),
       measures = list("fitbit_daily" = c("restingHeartRate")))

    # experiment(person = EX,
    #            variables = list("fitbit_daily" = c("sleepDuration", "steps")),
    #            measures = list("fitbit_daily" = c("restingHeartRate")),
    #            analysis = c("anova"),
    #            time_var = c("date"))
```

4.  Compare Groups
    To compare across time variables not already defined, such as months, users
    can set up groups.  In this case, only data from January and February is
    in the sample instance of Person, so only two groups are compared:
```{r}
dataset <- create_dataset(person = EX,
                          all_variables = list("util" = c("month"), 
                                               "fitbit_daily" = c("steps")), 
                          time_var = c("date"))

indiv_months <- data.frame("month" = c("Jan", "Feb", "Mar", "Apr", "May",
                                      "Jun", "Jul", "Aug",
                                      "Sep", "Oct", "Nov", "Dec"),
                           "group" = c(1:12))
 compare_groups(dataset, person = EX, 
                     addl_grouping_assignments = list("indiv_months" = indiv_months), 
                     names_of_groupings = c("indiv_months"),
                     variables_to_compare = c("steps"))                                  
```

Groups can even be assigned to an instantiation of a Person:
```{r}
group_months <- data.frame("month" = c("Jan", "Feb", "Mar", "Apr", "May",
                                        "Jun", "Jul", "Aug",
                                        "Sep", "Oct", "Nov", "Dec"),
                              "group" = c(0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0))
ash <- Person$new(user_info = list("name" = "Ash", "age" = 26, "gender" = 
                                     "female"), 
                  group_assignments = list("group_months" = group_months),
                  start_date = "2017-03-11",
                  end_date = "2017-03-12")
```

5.  Regression
```{r}
dataset <- create_dataset(person = EX,
                          all_variables = list("util" = c("day_of_week"), 
                                               "fitbit_daily" = c("sleepDuration", 
                                                                  "steps",
                                                                  "restingHeartRate")), 
                          time_var = c("date"))
all_models <- l_regression(dataset, person = EX, 
                           variables = list("util" = c("day_of_week"), 
                                            "fitbit_daily" = c("sleepDuration","steps")),
                      measures = list("fitbit_daily" = c("restingHeartRate")))

    # experiment(person = EX,
    #            variables = list("fitbit_daily" = c("steps")),
    #            measures = list("fitbit_daily" = c("restingHeartRate")),
    #            analysis = c("regression"),
    #            time_var = c("date"))
```


## Shiny Application

## Apple Data
